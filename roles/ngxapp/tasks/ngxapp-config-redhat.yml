---

- name: Configure core-site.xml stores s3 credentials
  template: src=core-site.xml.j2 dest=/etc/hadoop/conf/core-site.xml

- name: Create ngxapp user with tmx rpm package.
  yum:
     name: "{{ tsxacct_ngxuser_rpm }}"
     state: present

- name: Create ngx app directory
  file: path={{ ngx_app_dir }} state=directory recurse=yes owner={{ tsxacct_ngxuser }} group={{ tsxacct_ngxgroup }}

- name: Create/Update NGX zookeeper config
  znode: hosts={{ hostvars[groups['zookeepers'][0]].inventory_hostname }}:2181 name={{ item.name }} value={{ item.value }} state=present
  with_items: "{{ ngx_zookeeper_config }}"
  run_once: true
  delegate_to: 127.0.0.1
  ignore_errors: True

- name: Update NGX Zookeeper Crude ACL
  shell: echo "setAcl /ngx/source/Crude/pwd digest:{{ zookeeper_user }}:{{ zookeeper_digest }}:dr" | /usr/lib/zookeeper/bin/zkCli.sh
  run_once: true

- name: Update NGX Zookeeper GasMonthly ACL
  shell: echo "setAcl /ngx/source/GasMonthly/pwd digest:{{ zookeeper_user }}:{{ zookeeper_digest }}:dr" | /usr/lib/zookeeper/bin/zkCli.sh
  run_once: true

- name: Update NGX Zookeeper GasDaily ACL
  shell: echo "setAcl /ngx/source/GasDaily/pwd digest:{{ zookeeper_user }}:{{ zookeeper_digest }}:dr" | /usr/lib/zookeeper/bin/zkCli.sh
  run_once: true
